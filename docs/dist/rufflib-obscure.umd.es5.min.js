!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):((t="undefined"!=typeof globalThis?globalThis:t||self).rufflib=t.rufflib||{},t.rufflib.obscure=t.rufflib.obscure||{},t.rufflib.obscure.main=n())}(this,(function(){"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function r(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function e(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function c(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"==typeof t)return i(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}
/**
   * rufflib-obscure 0.0.1
   * A RuffLIB library for roughly encrypting and decrypting strings.
   * https://richplastow.com/rufflib-obscure
   * @license MIT
   */
/**
   * rufflib-validate 2.0.4
   * A RuffLIB library for succinctly validating JavaScript values.
   * https://richplastow.com/rufflib-validate
   * @license MIT
   */()}function i(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}var o="array",s="boolean",l="integer",u="number",f="string",h="object",y="undefined";function m(n,r,e){var a=r.concat(e).join(".");return t(n)===y?"'".concat(a,"' of a value"):"".concat(n,".").concat(a)}function p(n,r,e,a,i){if(null===n||t(n)!==h||Array.isArray(n)){var m=v(n);return r||0!==e.length?r?0===e.length?"'".concat(r,"' is ").concat(m," not an object"):"'".concat(r,".").concat(e.join("."),"' is ").concat(m," not an object"):"'".concat(e.join("."),"' of the schema is ").concat(m," not an object"):"the schema is ".concat(m," not an object")}var g=n._meta;if(null===g||t(g)!==h||Array.isArray(g)){var d=v(g);return r||0!==e.length?r?0===e.length?"'".concat(r,"._meta' is ").concat(d," not an object"):"'".concat(r,".").concat(e.join("."),"._meta' is ").concat(d," not an object"):"'".concat(e.join("."),"._meta' of the schema is ").concat(d," not an object"):"top level '_meta' of the schema is ".concat(d," not an object")}var k=n._meta.inst;if(void 0!==k){if(null===k||"function"!==t(k)||Array.isArray(k)){var x=v(k);return r||0!==e.length?r?0===e.length?"'".concat(r,"._meta.inst' is ").concat(x," not type 'function'"):"'".concat(r,".").concat(e.join("."),"._meta.inst' is ").concat(x," not type 'function'"):"'".concat(e.join("."),"._meta.inst' of the schema is ").concat(x," not type 'function'"):"top level '._meta.inst' of the schema is ".concat(x," not type 'function'")}if("string"!=typeof k.name){var A=v(k.name);return r||0!==e.length?r?0===e.length?"'".concat(r,"._meta.inst.name' is ").concat(A," not 'string'"):"'".concat(r,".").concat(e.join("."),"._meta.inst.name' is ").concat(A," not 'string'"):"'".concat(e.join("."),"._meta.inst.name' of the schema is ").concat(A," not 'string'"):"top level '._meta.inst.name' of the schema is ".concat(A," not 'string'")}}for(var j in n){var _=n[j];if(null===_||t(_)!==h||Array.isArray(_))return b(r,e,j,"is ".concat(v(_)," not an object"));if("_meta"!==j)if(_._meta){var N=p(_,r,[].concat(c(e),[j]),a,i);if(N)return N}else{if(null===_.fallback)return b(r,e,j,"is null","fallback");if(null===_.max)return b(r,e,j,"is null","max");if(null===_.min)return b(r,e,j,"is null","min");if(null===_.rule)return b(r,e,j,"is null","rule");if(null===_.set)return b(r,e,j,"is null","set");var w=Array.isArray(_.fallback)?o:t(_.fallback),E=Array.isArray(_.max)?o:t(_.max),S=Array.isArray(_.min)?o:t(_.min),V=Array.isArray(_.rule)?o:t(_.rule),O=Array.isArray(_.set)?o:t(_.set),T=w!==y,I=E!==y,P=S!==y,R=V!==y,C=O!==y,D=I+P+R+C;if(D>1&&(2!==D||!I||!P))return b(r,e,j,"has '".concat(D,"' qualifiers, only 0 or 1 allowed"));switch(_.kind){case o:return"@TODO array";case s:if(w!==s&&T)return b(r,e,j,"has '".concat(w,"' fallback, not '").concat(s,"' or '").concat(y,"'"));if(I)return b(r,e,j,"has '".concat(E,"' max, not '").concat(y,"'"));if(P)return b(r,e,j,"has '".concat(S,"' min, not '").concat(y,"'"));if(R)return b(r,e,j,"has '".concat(V,"' rule, not '").concat(y,"'"));if(C)return b(r,e,j,"has '".concat(O,"' set, not '").concat(y,"'"));break;case l:case u:if(w!==u&&T)return b(r,e,j,"has '".concat(w,"' fallback, not '").concat(u,"' or '").concat(y,"'"));if(E!==u&&I)return b(r,e,j,"has '".concat(E,"' max, not '").concat(u,"' or '").concat(y,"'"));if(S!==u&&P)return b(r,e,j,"has '".concat(S,"' min, not '").concat(u,"' or '").concat(y,"'"));if(V===h){var $=t(_.rule.test);if("function"!==$)return b(r,e,j,"has '".concat($,"' rule.test, not 'function'"))}else if(R)return b(r,e,j,"has '".concat(V,"' rule, not '").concat(h,"' or '").concat(y,"'"));if(O===o)for(var q=0,M=_.set.length;q<M;q++){var U=t(_.set[q]);if(U!==u)return b(r,e,j,"has '".concat(U,"' set[").concat(q,"], not '").concat(u,"'"))}else if(C)return b(r,e,j,"has '".concat(O,"' set, not an array or '").concat(y,"'"));break;case f:if(w!==f&&T)return b(r,e,j,"has '".concat(w,"' fallback, not '").concat(f,"' or '").concat(y,"'"));if(E!==u&&I)return b(r,e,j,"has '".concat(E,"' max, not '").concat(u,"' or '").concat(y,"'"));if(S!==u&&P)return b(r,e,j,"has '".concat(S,"' min, not '").concat(u,"' or '").concat(y,"'"));if(V===h){var z=t(_.rule.test);if("function"!==z)return b(r,e,j,"has '".concat(z,"' rule.test, not 'function'"))}else if(R)return b(r,e,j,"has '".concat(V,"' rule, not '").concat(h,"' or '").concat(y,"'"));if(O===o)for(var B=0,F=_.set.length;B<F;B++){var G=t(_.set[B]);if(G!==f)return b(r,e,j,"has '".concat(G,"' set[").concat(B,"], not '").concat(f,"'"))}else if(C)return b(r,e,j,"has '".concat(O,"' set, not an array or '").concat(y,"'"));break;default:return b(r,e,j,"not recognised","kind")}}else if(a){var H=r&&e.length?"".concat(r,".").concat(e.join("."),"._meta"):r?"".concat(r,"._meta"):e.length?"".concat(e.join("."),"._meta"):"top level _meta";if(!i.object(_,H,a))return i.err.slice(i.prefix.length+2)}}return null}function b(t,n,r,e,a){return"'".concat(t?t+".":"").concat(0===n.length?"":n.join(".")+".").concat(r||"").concat(a?"."+a:"","'").concat(t?"":" of the schema"," ").concat(e)}function v(n){return null===n?"null":Array.isArray(n)?"an array":"type '".concat(t(n),"'")}var g=e((function t(r,e){n(this,t),this.err=null,this.prefix=r||"(anon)",this.skip=e||!1}));a(g,"name","Validate"),a(g,"VERSION","2.0.4"),g.prototype._type=function(n,r,e){var a=t(n);if(a===e)return!0;var c="string"==typeof r?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"a value";return this.err=null===n?"".concat(this.prefix,": ").concat(c," is null not type '").concat(e,"'"):Array.isArray(n)?"".concat(this.prefix,": ").concat(c," is an array not type '").concat(e,"'"):"".concat(this.prefix,": ").concat(c," is type '").concat(a,"' not '").concat(e,"'"),!1},g.prototype._validateAgainstSchema=function(n,r,e){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e._meta.inst&&!(n instanceof e._meta.inst))return r||0!==a.length?r?0===a.length?this.err="".concat(this.prefix,": '").concat(r,"' is not an instance of '").concat(e._meta.inst.name,"'"):this.err="".concat(this.prefix,": '").concat(r,".").concat(a.join("."),"' is not an instance of '").concat(e._meta.inst.name,"'"):this.err="".concat(this.prefix,": '").concat(a.join("."),"' of the top level object is not an instance of '").concat(e._meta.inst.name,"'"):this.err="".concat(this.prefix,": the top level object is not an instance of '").concat(e._meta.inst.name,"'"),!1;for(var c in e)if("_meta"!==c){var i=n[c],p=t(i),b=e[c];if(b._meta){if(null===i||p!==h||Array.isArray(i)){var v=m(r,a,c),g=" of a value"===v.slice(-11)?v:"'".concat(v,"'"),d=null===i?"null":p!==h?"type '".concat(p,"'"):"an array";return this.err="".concat(this.prefix,": ").concat(g," is ").concat(d," not an object"),!1}if(!this._validateAgainstSchema(i,r,b,a.concat(c)))return!1}else{var k=t(b.fallback),x=k!==y,A=p===y;if(!x||!A){var j=m(r,a,c);switch(b.kind){case o:return"@TODO array";case s:if(!this.boolean(i,j))return!1;continue;case l:case u:case f:var _=t(b.max)!==y,N=t(b.min)!==y;if(_&&N){if(!this[b.kind](i,j,b.min,b.max))return!1}else if(N){if(!this[b.kind](i,j,b.min))return!1}else if(_){if(!this[b.kind](i,j,void 0,b.max))return!1}else if(b.rule){if(!this[b.kind](i,j,b.rule))return!1}else if(b.set){if(!this[b.kind](i,j,b.set))return!1}else if(!this[b.kind](i,j))return!1;continue;default:throw this.err="oops!!",Error(this.err)}}}}return!0},g.prototype.array=function(n,r){if(this.err=null,this.skip)return!0;if(!Array.isArray(n)){var e="string"==typeof r?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"a value";return this.err=null===n?"".concat(this.prefix,": ").concat(e," is null not an array"):"".concat(this.prefix,": ").concat(e," is type '").concat(t(n),"' not an array"),!1}for(var a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];var s=i.length;if(!s)return!0;var l=0,u=1/0,f=null,h=[],y=t(i[0]),m="function"===y?"fn":"number"===y?"num":null==i[0]?"null":"other",p=t(i[1]),b="function"===p?"fn":"number"===p?"num":null==i[1]?"null":"other",v=t(i[2]),g="function"===v?"fn":"number"===v?"num":null==i[2]?"null":"other";switch("".concat(m,",").concat(b,",").concat(g)){case"null,null,null":for(var d=3;d<s;d++)if(null!=i[d])throw this.err="Validate.array() incorrectly invoked 1: args[".concat(d,"] not nullish!"),Error(this.err);return!0;case"num,null,null":for(var k=3;k<s;k++)if(null!=i[k])throw this.err="Validate.array() incorrectly invoked 2: args[".concat(k,"] not nullish!"),Error(this.err);l=i[0];break;case"num,num,null":for(var x=3;x<s;x++)if(null!=i[x])throw this.err="Validate.array() incorrectly invoked 3: args[".concat(x,"] not nullish!"),Error(this.err);l=i[0],u=i[1];break;case"null,num,null":for(var A=3;A<s;A++)if(null!=i[A])throw this.err="Validate.array() incorrectly invoked 4: args[".concat(A,"] not nullish!"),Error(this.err);u=i[1];break;case"num,num,fn":l=i[0],u=i[1],f=i[2],h=i.slice(3);break;case"num,null,fn":l=i[0],f=i[2],h=i.slice(3);break;case"null,num,fn":u=i[1],f=i[2],h=i.slice(3);break;default:if("fn"===m)f=i[0],h=i.slice(1);else{if("num"!==m||"fn"!==b)throw this.err="Validate.array() incorrectly invoked 5: args is not one of the nine configurations!",Error(this.err);l=i[0],f=i[1],h=i.slice(2)}}if(Number.isNaN(l))throw this.err="Validate.array() incorrectly invoked: min is NaN!",Error(this.err);if(Number.isNaN(u))throw this.err="Validate.array() incorrectly invoked: max is NaN!",Error(this.err);if(n.length<l){var j=r?"'".concat(r,"'"):"array";return this.err="".concat(this.prefix,": ").concat(j," length ").concat(n.length," is < ").concat(l),!1}if(n.length>u){var _=r?"'".concat(r,"'"):"array";return this.err="".concat(this.prefix,": ").concat(_," length ").concat(n.length," is > ").concat(u),!1}if(null==f)return!0;for(var N=r||"",w=0,E=n.length;w<E;w++)if(!f.bind(this).apply(void 0,[n[w],"".concat(N,"[").concat(w,"]")].concat(c(h))))return!1;return!0},g.prototype.boolean=function(t,n){return this.err=null,!!this.skip||this._type(t,n,"boolean")},g.prototype.class=function(n,r,e){if(this.err=null,this.skip)return!0;if(t(r)!==f||" of a value"===r.slice(-11)||"'".concat(r,"'"),!this._type(n,r,"function"))return!1;if(t(e)===y)return!0;if(!this.schema(e,"schema"))throw Error("Validate.class() incorrectly invoked: ".concat(this.err));return!!this._validateAgainstSchema(n,r,e)},g.prototype.integer=function(t,n,r,e){if(this.err=null,this.skip)return!0;if(!this.number(t,n,r,e))return!1;if(0!=t%1){var a="string"==typeof n?" of a value"===n.slice(-11)?n:"'".concat(n,"'"):"number";return this.err="".concat(this.prefix,": ").concat(a," ").concat(t," is not an integer"),!1}return!0},g.prototype.number=function(n,r,e,a){if(this.err=null,this.skip)return!0;if(!this._type(n,r,"number"))return!1;if(Number.isNaN(n))return this.err="".concat(this.prefix,": '").concat(r,"' is NaN, not a valid number"),!1;var c="object"===t(e)&&null!=e,i="string"==typeof r?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"number";if(c&&Array.isArray(e)){if(-1!==e.indexOf(n))return!0;var o="[".concat(e,"]");return o=o.length<21?o:"".concat(o.slice(0,12),"...").concat(o.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(n," is not in ").concat(o),!1}if(c&&"function"==typeof e.test){if(e.test(n))return!0;var s="".concat(e.test);return s=s.length<21?s:"".concat(s.slice(0,12),"...").concat(s.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(n," fails ").concat(s),!1}if("number"==typeof e){var l=e;if(Number.isNaN(l))throw this.err="Validate.number() incorrectly invoked: min is NaN!",Error(this.err);if(n<l)return this.err="".concat(this.prefix,": ").concat(i," ").concat(n," is < ").concat(l),!1}if("number"==typeof a){if(Number.isNaN(a))throw this.err="Validate.number() incorrectly invoked: max is NaN!",Error(this.err);if(n>a)return this.err="".concat(this.prefix,": ").concat(i," ").concat(n," is > ").concat(a),!1}return!0},g.prototype.object=function(n,r,e){if(this.err=null,this.skip)return!0;var a=t(r)===f?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"a value";if(null===n)return this.err="".concat(this.prefix,": ").concat(a," is null not an object"),!1;if(Array.isArray(n))return this.err="".concat(this.prefix,": ").concat(a," is an array not an object"),!1;if(!this._type(n,r,"object"))return!1;if(t(e)===y)return!0;if(!this.schema(e,"schema"))throw Error("Validate.object() incorrectly invoked: ".concat(this.err));return!!this._validateAgainstSchema(n,r,e)},g.prototype.schema=function(n,r,e){if(this.err=null,this.skip)return!0;if(t(e)!==y&&(null===e||t(e)!==h||Array.isArray(e))){var a=v(e);throw Error("Validate.schema() incorrectly invoked: ".concat(this.prefix,": ")+"optional 'metaSchema' is ".concat(a," not an object"))}var c=p(n,r,[],e,this);return!c||(this.err="".concat(this.prefix,": ").concat(c),!1)},g.prototype.string=function(n,r,e,a){if(this.err=null,this.skip)return!0;if(!this._type(n,r,"string"))return!1;var c="object"===t(e)&&null!=e,i="string"==typeof r?" of a value"===r.slice(-11)?r:"'".concat(r,"'"):"string";if(c&&Array.isArray(e)){if(-1!==e.indexOf(n))return!0;var o='"'.concat(n,'"');o=o.length<21?o:"".concat(o.slice(0,12),"...").concat(o.slice(-5));var s="[".concat(e,"]");return s=s.length<21?s:"".concat(s.slice(0,12),"...").concat(s.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(o," is not in ").concat(s),!1}if(c&&"function"==typeof e.test){if(e.test(n))return!0;var l='"'.concat(n,'"');l=l.length<21?l:"".concat(l.slice(0,12),"...").concat(l.slice(-5));var u="".concat(e instanceof RegExp?e:e.test);return u=u.length<21?u:"".concat(u.slice(0,12),"...").concat(u.slice(-5)),this.err="".concat(this.prefix,": ").concat(i," ").concat(l," fails ").concat(u),!1}if("number"==typeof e){var f=e;if(Number.isNaN(f))throw this.err="Validate.string() incorrectly invoked: min is NaN!",Error(this.err);if(n.length<f)return this.err="".concat(this.prefix,": ").concat(i," length ").concat(n.length," is < ").concat(f),!1}if("number"==typeof a){if(Number.isNaN(a))throw this.err="Validate.string() incorrectly invoked: max is NaN!",Error(this.err);if(n.length>a)return this.err="".concat(this.prefix,": ").concat(i," length ").concat(n.length," is > ").concat(a),!1}return!0};var d=/^[ -~]{0,255}$/,k=function(){function t(r){n(this,t);var e=new g("new Obscure()",!1);if(!e.string(r,"salt",d))return this.error=e.err;this.salt=r}return e(t,[{key:"toObject",value:function(){return{salt:this.salt}}}]),t}();return a(k,"name","Obscure"),a(k,"VERSION","0.0.1"),k}));
